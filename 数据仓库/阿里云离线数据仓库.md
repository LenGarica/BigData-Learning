# 基于阿里云搭建离线数据仓库


在阿里云架构上搭建数据仓库，理解整个数据架构从采集、存储、计算、输出、展示的整个业务流程

## 数仓项目的流程

1. 采集埋点日志数据（通常指的是用户行为日志）
2. 采集业务数据库中数据（通常指关系型数据库存放的业务数据）
3. 数据仓库的搭建（将用户行为日志和业务数据进行存储、过滤、转义等操作）
4. 分析统计业务指标
5. 对结果进行可视化展示

## 阿里云技术框架

|阿里云产品|简介|类比|
|--|--|--|
|DataHub|数据总线|Kafka+各种服务接口|
|MaxCompute|大数据计算框架|Hadoop+Hive+调度器|
|DataWorks|可视化MaxCompute的开发管理平台|本质就是一个web界面|
|RDS|关系行数据库|MySql|
|QuickBI|可视化数据展示工具|Echarts、Kibana|
|ESC|弹性服务器|Linux服务器|

## 技术选型

|类别|阿里云平台提供的框架|业界流行的框架|
|--|--|--|
|数据采集与传输|Flume、DataHub、RDS|Flume、Kafka、Sqoop|
|数据存储|MaxCompute、DataWorks|MySql、Hadoop、HBase|
|计算|MaxCompute、DataWorks|Hive、Spark、Flink|
|数据可视化|QuickBI|Echarts、Kibana|

## 机器的考量

|类型|配置|计算|报价|
|--|--|--|--|
|学校标配|华为128G内存，16核16线程，8THDD和2TSSD|24小时不断电，寿命5年|2W-3W|
|企业用户|华为128G内存，16核16线程，8THDD和2TSSD|5年电费2W+，运维人员5年工资60W，数据开发人员60W、数据平台开发人员60W|总价184W+|
|阿里云主机|128G内存，16核16线程，8THDD和2TSSD|省去运维、电费、硬盘损坏更换，5年的MaxCompute费用10万|总价47W+|

## 集群规模

1. 用户行为日志

每天日活1百万，那么用户行为日志大概1000万条、每条日志1k大小，每天就1一条，占用100G大小。对于数据会进行压缩，通常采用LZO+parquet格式存储，大概能够压缩到10G。而数仓中分层ODS10G、DWD10G、DWS50G，ADS很小、在副本为3的情况下，要占用210G，半年内，用户量不增不减，大概会使用37T大小，还需要预留30%的缓冲区，总共53T。

2. DataHub中数据

每天100G，外加一个副本（默认两个），占200G，保存三天（默认7天）占用600G，外加30%的缓存区，约占1T。

3. 业务数据

Web端来的数据，100万中10万人下单，每人业务数据10条，每条1k，一天占用1G大小，数仓分层中共占0.3G，副本*3，共0.9G，半年不扩容，0.16T，外加缓冲总共0.2T

综上，整个集群大概要占用54.2T，需要使用8THDD * 7台
